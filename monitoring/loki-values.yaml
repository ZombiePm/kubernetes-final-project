# Minimal Loki configuration with volume support
deploymentMode: SingleBinary

loki:
  auth_enabled: false
  commonConfig:
    replication_factor: 1
    path_prefix: /tmp/loki
  storage:
    type: 'filesystem'
    filesystem:
      chunks_directory: /tmp/loki/chunks
      rules_directory: /tmp/loki/rules
    bucketNames:
      chunks: chunks
      ruler: ruler
      admin: admin
  limits_config:
    volume_enabled: true
    allow_structured_metadata: true
  pattern_ingester:
    enabled: true
  # Define our own schema instead of using test schema
  schemaConfig:
    configs:
    - from: "2024-01-01"
      store: tsdb
      object_store: filesystem
      schema: v13
      index:
        prefix: index_
        period: 24h

singleBinary:
  replicas: 1
  persistence:
    enabled: false

# Disable all scalable components
backend:
  replicas: 0

read:
  replicas: 0

write:
  replicas: 0

# Disable caching
chunksCache:
  enabled: false

resultsCache:
  enabled: false

# Disable gateway
gateway:
  enabled: false

# Resource adjustments
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Disable Grafana since we're using the one from kube-prometheus-stack
grafana:
  enabled: false

promtail:
  enabled: true
  config:
    logLevel: info
    serverPort: 3101
    clients:
      - url: http://loki:3100/loki/api/v1/push